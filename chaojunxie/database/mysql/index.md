## 索引

+ 索引组织表

  InnoDB中，表都是根据主键已索引的形式存放的，这样的表就是索引组织表。每个索引都会构成一个B+树。

  对于这个表：

  ```mysql
  create table T(
  	id int primary key, 
  	k int not null, 
  	name varchar(16),
  	index (k)
  )engine=InnoDB;
  ```

  假设对于(id, k)插入记录(100, 1), (200, 2), (300, 3), (500, 5), (600, 6)，会构建成两颗B+树

  TODO 图表

+ 索引分类

  + 主键索引(聚簇索引)

    主键索引的叶子节点是每行的记录。主键索引不能取空值。通过主键索引，可以直接获取到需要读取的行记录。

  + 非主键索引(二级索引)

    非主键索引的值是对应行的主键的值。通过二级索引，可以获取到主键的值，然后再通过主键索引获取到需要读的行。这个动作称为回表。

    + 唯一索引

      和主键索引类似，都是唯一的，但是可以为空值，如果是复合索引，那么组合要唯一。

    + 普通索引

+ 覆盖索引

+ 最左前缀原则

+ 索引下推(5.6引入)

+ 普通索引 vs 唯一索引

  + 读取

    唯一索引的读取过程，会比普通索引读少一次，因为是唯一的，而普通索引需要多读下一条来判断符不符合。但是总体来说，区别不大。

  + 写入

    唯一索引是没法使用change buffer的，因为需要把数据页读入，然后判断是否值是否唯一。

    对于普通索引，如果是写多读少的情况下，change buffer会起到比较好的优化左右。但是如果在更新了马上读入的场景，用change buffer的话会起反作用，因为change buffer本身会占用内存。

  + 在实际使用中，你会发现，普通索引和change buffer 的配合使用，对于数据量大的表的更新优化还是很明显的。**

+ 错误选择索引

  有些情况下优化器会错误的选择索引。优化器选择索引的一个重要参考维度是一个索引的基数(cardinality)，也就是索引的区分度。这个基数是通过采样统计的方法取得。InnoDB会默认选择N个数据页，统计这些页里面索引的基数，然后取得平均值。这个采样统计，在一定条件下会自动触发。这样的情况可以通过analyze table命令来触发这个采样统计

  另外，也可以通过force index()来指定使用哪个索引的方式。

+ 索引失效

+ 