## 对象分配过程

1. 在方法区中检查这个对象的类是否已经被加载

2. 在堆里面，给这个对象分配内存

   内存的分配方法根据堆是否为连续的，分为指针碰撞(bump the pointer)和空闲列表(free list)。

3. 把这个分配到的区域都初始化为零（对象头除外）

   这样就保证了对象的属性，不需要手动初始化都会带有默认值

4. 设置对象的必要信息

   包括了是哪个类的实例、对应的哈希码等，这些值都设置在对象头。

5. 执行Class文件中的init方法

## 对象在内存中的布局

1. 对象头(header)

   对象头的数据可以分为以下两部分

   1. 存放hash code、gc分代年龄、锁状态等信息，被称为mark word
   2. 类型指针。指向对象类型元数据的指针。通过这个指针，可以确定到对象的类型。如果是数组，还会存放数组的长度。

2. 实例数据(instance data)

   代码里面定义的各种类型的字段内容，包括了从父类继承的和自身定义的。

3. 对齐填充(padding)

## 对象的访问定位

栈中的reference类型定位到堆中对象实例有两种方法

1. 使用句柄(handle)

   使用句柄的情况，堆中部分的内存会被开辟来作为句柄池。一个句柄会包含两部分的内容，一部分指向对象实例，一部分指向方法区中对象类型数据。reference里面保存的就是句柄的地址。使用句柄的好处在于，当对象被一定的时候，只需要修改句柄中对象实例部分的值。

2. 直接指针(direct pointer)

   使用直接指针的情况，reference就直接指向堆中的实例对象。这样的好处是读取的时候，少了一次内存访问。

